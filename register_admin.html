<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Crear Admin User</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    </button>

    <div id="status" style="margin-top: 20px; color: #475569;">Esperando acción...</div>
    </div>

    <script>
        async function createAdmin() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            btn.disabled = true;
            status.textContent = 'Procesando...';

            const email = 'prehouses24h@gmail.com';
            const password = '123456';

            try {
                // 1. Try to Register
                try {
                    const result = await auth.createUserWithEmailAndPassword(email, password);
                    status.textContent = '✅ Usuario CREADO correctamente. Iniciando sesión...';
                    await saveUser(result.user);
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        status.textContent = '⚠️ El usuario ya existe. Intentando iniciar sesión...';
                        await auth.signInWithEmailAndPassword(email, password);
                        status.textContent = '✅ Sesión iniciada correctamente.';
                    } else {
                        throw error;
                    }
                }

                // 2. Refresh User & Redirect
                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1500);

            } catch (error) {
                console.error(error);
                status.textContent = '❌ Error: ' + error.message;
                btn.disabled = false;
            }
        }

        async function saveUser(user) {
            await db.collection('users').doc(user.uid).set({
                email: user.email,
                userType: 'empresa', // Set as admin/empresa
                displayName: 'Admin Prehouses',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'approved'
            }, { merge: true });
        }
    </script>
    </body>

</html>