<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prehouses | Buscador de Casas Prefabricadas en España</title>
    <meta name="description"
        content="Encuentra y compara las mejores casas prefabricadas en España. Buscador de modelos, precios y fabricantes.">

    <link rel="stylesheet" href="styles.css">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Navegación Simple -->
    <header>
        <div class="container nav-flex">
            <a href="index.html" class="logo">PREHOUSES</a>
            <nav class="nav-links">
                <a href="catalogo.html">Catálogo</a>
                <a href="asesor.html">Asesor IA</a>
                <a href="blog.html">Blog</a>
            </nav>
        </div>
    </header>

    <!-- Área de Búsqueda -->
    <section class="search-hero">
        <div class="container">
            <h1>Buscador de casas prefabricadas</h1>

            <div class="main-search">
                <div class="search-input-group">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="searchInput"
                        placeholder="¿Qué estás buscando? (ej: hormigón, madera, Madrid...)">
                </div>
                <button class="btn-search" onclick="handleSearch()">Buscar</button>
            </div>

            <div class="quick-filters">
                <a href="catalogo.html?tipo=hormigon" class="filter-tag">Hormigón</a>
                <a href="catalogo.html?tipo=madera" class="filter-tag">Madera</a>
                <a href="catalogo.html?tipo=modulares" class="filter-tag">Modulares</a>
                <a href="catalogo.html?tipo=baratas" class="filter-tag">Económicas</a>
            </div>
        </div>
    </section>

    <!-- Resultados / Listas -->
    <section class="results-section">
        <div class="container">
            <h2 class="section-title">Modelos en España</h2>

            <div id="featuredHousesGrid" class="house-list">
                <!-- Cargado con JS -->
                <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #64748b;">
                    <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 12px;"></i>
                    <p>Cargando modelos destacados...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Pie de Página -->
    <footer>
        <div class="container">
            <p>&copy; 2025 PREHOUSES - El portal de la vivienda prefabricada en España</p>
            <div style="margin-top: 12px; display: flex; justify-content: center; gap: 20px;">
                <a href="privacidad.html" style="color: inherit; text-decoration: none;">Privacidad</a>
                <a href="cookies.html" style="color: inherit; text-decoration: none;">Cookies</a>
                <a href="aviso-legal.html" style="color: inherit; text-decoration: none;">Aviso Legal</a>
            </div>
        </div>
    </footer>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
        function handleSearch() {
            const query = document.getElementById('searchInput').value;
            window.location.href = `catalogo.html?q=${encodeURIComponent(query)}`;
        }

        async function loadHouses() {
            const container = document.getElementById('featuredHousesGrid');
            if (!container) return;

            try {
                const snapshot = await db.collection('houses').limit(6).get();

                if (snapshot.empty) {
                    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No se han encontrado modelos.</p>';
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const house = doc.data();
                    const img = Array.isArray(house.images) && house.images.length > 0 ? house.images[0] : (house.image || 'https://via.placeholder.com/400x300?text=Prehouses');
                    const price = typeof house.price === 'number' ? new Intl.NumberFormat('es-ES').format(house.price) + '€' : house.price;

                    html += `
                        <article class="house-item">
                            <a href="detalle-casa.html?id=${doc.id}" style="text-decoration: none; color: inherit;">
                                <img src="${img}" class="house-img" alt="${house.title}">
                                <div class="house-content">
                                    <div class="house-price">${price}</div>
                                    <h3 class="house-title">${house.title}</h3>
                                    <p class="house-loc">${house.location || 'España'}</p>
                                    <div class="house-features">
                                        <span>${house.area} m²</span>
                                        <span>${house.rooms || house.bedrooms || 0} hab.</span>
                                        <span>${house.bathrooms} b.</span>
                                    </div>
                                </div>
                            </a>
                        </article>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error(error);
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: red;">Error al cargar los datos.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadHouses, 300);

            // Permitir buscar con Enter
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
        });
    </script>
</body>

</html>